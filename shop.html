<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>Restaurant - AlexLivraison</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<style>
  :root {
    --primary: #E63946;
    --bg: #F8F9FA;
    --text: #1D1D1F;
    --surface: #FFFFFF;
    --shadow: 0 4px 12px rgba(0,0,0,0.08);
  }
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  body {
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    background: var(--bg);
    margin: 0; padding: 0;
    color: var(--text);
    padding-bottom: 80px;
  }
  .shop-header {
    background: var(--surface);
    padding: 15px 20px;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  }
  .top-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
  }
  .back-btn {
    font-size: 1.2em;
    color: #333;
    text-decoration: none;
    display: flex; align-items: center; gap: 5px;
  }
  .shop-title {
    font-size: 1.2em;
    font-weight: 800;
  }
  .categories {
    display: flex;
    gap: 20px;
    overflow-x: auto;
    padding-bottom: 5px;
    scrollbar-width: none;
  }
  .categories::-webkit-scrollbar { display: none; }
  .cat-link {
    color: #888;
    font-weight: 600;
    white-space: nowrap;
    cursor: pointer;
    padding-bottom: 5px;
    border-bottom: 3px solid transparent;
    transition: 0.3s;
  }
  .cat-link.active {
    color: #F4C430;
    border-bottom-color: #F4C430;
  }
  .product-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    padding: 15px;
  }
  .prod-card {
    background: var(--surface);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: var(--shadow);
    cursor: pointer;
    transition: 0.2s;
    display: flex;
    flex-direction: column;
  }
  .prod-card:active { transform: scale(0.98); }
  .prod-img {
    width: 100%;
    height: 100px;
    object-fit: cover;
    background: #eee;
  }
  .prod-info {
    padding: 8px;
    display: flex;
    flex-direction: column;
    flex: 1;
  }
  .prod-name {
    font-weight: 700;
    font-size: 0.85em;
    margin-bottom: 5px;
    line-height: 1.2;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .prod-price {
    margin-top: auto;
    font-weight: 800;
    font-size: 0.95em;
    text-align: right;
  }
  .modal {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: var(--bg);
    z-index: 1000;
    display: none;
    flex-direction: column;
    overflow-y: auto;
    animation: slideUp 0.3s ease-out;
  }
  @keyframes slideUp { from {transform: translateY(100%);} to {transform: translateY(0);} }
  .modal-img-container {
    width: 100%;
    height: 250px;
    position: relative;
  }
  .modal-img {
    width: 100%; height: 100%; object-fit: cover;
  }
  .close-modal {
    position: absolute; top: 15px; left: 15px;
    background: rgba(255,255,255,0.9);
    width: 40px; height: 40px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 1.2em; cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.2);
  }
  .modal-content {
    padding: 20px;
    background: var(--surface);
    border-radius: 20px 20px 0 0;
    margin-top: -20px;
    position: relative;
    flex: 1;
    padding-bottom: 100px;
  }
  .modal-title { font-size: 1.6em; font-weight: 800; margin-bottom: 5px; }
  .modal-desc { color: #666; font-size: 0.95em; line-height: 1.5; margin-bottom: 15px; }
  .modal-base-price { font-size: 1.2em; font-weight: 700; color: var(--text); margin-bottom: 20px; }
  .option-section {
    margin-top: 25px;
    border-top: 1px solid #eee;
    padding-top: 15px;
  }
  .opt-header {
    display: flex; justify-content: space-between; align-items: center;
    font-weight: 700; font-size: 1.1em; margin-bottom: 15px;
  }
  .opt-header span.tag {
    background: #fdf2d0; color: #e6ae25; padding: 4px 8px; border-radius: 5px; font-size: 0.7em; text-transform: uppercase;
  }
  .opt-item {
    display: flex; justify-content: space-between; align-items: center;
    padding: 12px 0; border-bottom: 1px solid #f9f9f9;
  }
  .opt-label { display: flex; align-items: center; gap: 10px; }
  .opt-img { width: 40px; height: 40px; object-fit: cover; border-radius: 5px; }
  .custom-cb {
    width: 24px; height: 24px; border: 2px solid #ddd; border-radius: 4px;
    display: flex; align-items: center; justify-content: center;
    transition: 0.2s;
  }
  input[type="checkbox"]:checked + .custom-cb, input[type="radio"]:checked + .custom-cb {
    background: #F4C430; border-color: #F4C430;
  }
  input { display: none; }
  .bottom-bar {
    position: fixed; bottom: 0; left: 0; width: 100%;
    background: var(--surface); padding: 15px 20px;
    box-shadow: 0 -5px 20px rgba(0,0,0,0.05);
    display: flex; flex-direction: column; gap: 10px;
    z-index: 1001;
  }
  .qty-selector {
    display: flex; justify-content: center; align-items: center; gap: 20px; margin-bottom: 10px;
  }
  .qty-btn {
    width: 40px; height: 40px; background: #f0f0f0; border-radius: 50%;
    display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2em; cursor: pointer;
  }
  .qty-val { font-size: 1.2em; font-weight: bold; }
  .add-btn {
    width: 100%; padding: 16px;
    background: #F4Ebd0;
    color: #333;
    border: none; border-radius: 12px;
    font-size: 1.1em; font-weight: 700;
    cursor: pointer;
    display: flex; justify-content: space-between; align-items: center;
  }
  .add-btn.active { background: #F4C430; }
  .loader { text-align: center; padding: 40px; color: #888; }
  .anim-back { display: inline-block; animation: backBounce 1.5s infinite; }
  @keyframes backBounce { 0%, 100% { transform: translateX(0); } 50% { transform: translateX(-3px); } }
</style>
</head>
<body>

<div class="shop-header">
  <div class="top-nav">
    <a href="#" onclick="history.back()" class="back-btn"><span class="anim-back">‚Ü©Ô∏è</span></a>
    <div class="shop-title" id="headerTitle">Chargement...</div>
    <div><i class="fas fa-search"></i></div>
  </div>
  
  <div class="categories" id="catTabs">
    <div class="cat-link active" onclick="filterCat('all')">Tous</div>
    <div class="cat-link" onclick="filterCat('best')">Best sellers</div>
    <div class="cat-link" onclick="filterCat('menus')">Nos Menus</div>
    <div class="cat-link" onclick="filterCat('burgers')">Burgers</div>
    <div class="cat-link" onclick="filterCat('sandwichs')">Sandwichs</div>
  </div>
</div>

<div id="products-container" class="product-grid">
    <div class="loader">Chargement des produits...</div>
</div>

<div id="productModal" class="modal">
    <div class="modal-img-container">
        <img id="m-img" src="" class="modal-img">
        <div class="close-modal" onclick="closeModal()">‚úï</div>
    </div>
    
    <div class="modal-content">
        <h1 class="modal-title" id="m-name">Nom produit</h1>
        <div class="modal-desc" id="m-desc">Description ici...</div>
        <div class="modal-base-price" id="m-price">0,00 ‚Ç¨</div>

        <form id="optionsForm">
            <div class="option-section">
                <div class="opt-header">Seul ou en menu ? <span class="tag">OBLIGATOIRE</span></div>
                <label class="opt-item">
                    <span class="opt-label">üçî Seul</span>
                    <input type="radio" name="type" value="0" checked onchange="calcTotal()">
                    <div class="custom-cb"></div>
                </label>
                <label class="opt-item">
                    <span class="opt-label">üçüü•§ Menu (+2.50‚Ç¨)</span>
                    <input type="radio" name="type" value="2.50" onchange="calcTotal()">
                    <div class="custom-cb"></div>
                </label>
            </div>

            <div class="option-section">
                <div class="opt-header">Choisis ta sauce üå∂Ô∏è <span class="tag">1 √† 2 MAX</span></div>
                <div id="sauces-list"></div>
            </div>

            <div class="option-section">
                <div class="opt-header">Enlever un ingr√©dient ? ü•ó <span class="tag">OPTIONNEL</span></div>
                <label class="opt-item">
                    <span class="opt-label">Sans Oignons</span>
                    <input type="checkbox" class="opt-ing" onchange="calcTotal()">
                    <div class="custom-cb"></div>
                </label>
                <label class="opt-item">
                    <span class="opt-label">Sans Tomate</span>
                    <input type="checkbox" class="opt-ing" onchange="calcTotal()">
                    <div class="custom-cb"></div>
                </label>
            </div>

             <div class="option-section">
                <div class="opt-header">Envie d'un suppl√©ment ? üßÄ <span class="tag">OPTIONNEL</span></div>
                <label class="opt-item">
                    <span class="opt-label">Cheddar (+1.00‚Ç¨)</span>
                    <input type="checkbox" class="opt-sup" value="1.00" onchange="calcTotal()">
                    <div class="custom-cb"></div>
                </label>
                <label class="opt-item">
                    <span class="opt-label">Bacon (+1.50‚Ç¨)</span>
                    <input type="checkbox" class="opt-sup" value="1.50" onchange="calcTotal()">
                    <div class="custom-cb"></div>
                </label>
            </div>
        </form>
    </div>

    <div class="bottom-bar">
        <div class="qty-selector">
            <div class="qty-btn" onclick="changeQty(-1)">-</div>
            <div class="qty-val" id="qtyVal">1</div>
            <div class="qty-btn" onclick="changeQty(1)" style="color:#F4C430">+</div>
        </div>
        <button class="add-btn active" onclick="addToCart()">
            <span>Ajouter au panier</span>
            <span id="totalBtn">0,00 ‚Ç¨</span>
        </button>
    </div>
</div>

<script>
const firebaseConfig={apiKey:"AIzaSyAWagPwv5Skh_EHfdcnFTYeG-xltRM7yPc",authDomain:"alex-livraison.firebaseapp.com",projectId:"alex-livraison",storageBucket:"alex-livraison.firebasestorage.app",messagingSenderId:"937475497279",appId:"1:937475497279:web:62dc9eba8e77a5113ec78a"};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

const params = new URLSearchParams(window.location.search);
const shopId = params.get('id');
let currentProduct = null;
let quantity = 1;
let basePrice = 0;

const sauces = [
    {name: "Mayonnaise", img: "https://img.icons8.com/color/48/mayonnaise.png"},
    {name: "Ketchup", img: "https://img.icons8.com/color/48/ketchup.png"},
    {name: "Alg√©rienne", img: "https://img.icons8.com/color/48/chili-sauce.png"},
    {name: "Blanche", img: "https://img.icons8.com/color/48/sour-cream.png"},
    {name: "Curry", img: "https://img.icons8.com/color/48/curry.png"}
];

async function init(){
    const sauceCont = document.getElementById('sauces-list');
    sauces.forEach(s => {
        sauceCont.innerHTML += `
        <label class="opt-item">
            <div class="opt-label">
                <img src="${s.img}" class="opt-img">
                ${s.name}
            </div>
            <input type="checkbox" name="sauce" class="opt-sauce">
            <div class="custom-cb"></div>
        </label>`;
    });

    if(shopId){
        const sDoc = await db.collection('shops').doc(shopId).get();
        if(sDoc.exists) document.getElementById('headerTitle').innerText = sDoc.data().name;

        const snap = await db.collection('products').where('shopId','==',shopId).get();
        const grid = document.getElementById('products-container');
        grid.innerHTML = '';
        
        if(snap.empty){
            grid.innerHTML = '<div style="grid-column:span 3;text-align:center;margin-top:50px">Aucun produit</div>';
            return;
        }

        snap.forEach(doc => {
            const p = doc.data();
            const html = `
            <div class="prod-card" onclick="openProduct('${p.name}', '${p.desc}', ${p.price}, '${p.imageUrl}')">
                <img src="${p.imageUrl}" class="prod-img">
                <div class="prod-info">
                    <div class="prod-name">${p.name}</div>
                    <div class="prod-price">${p.price} ‚Ç¨</div>
                </div>
            </div>`;
            grid.innerHTML += html;
        });
    }
}

function openProduct(name, desc, price, img){
    currentProduct = {name, price};
    basePrice = parseFloat(price);
    quantity = 1;
    
    document.getElementById('m-name').innerText = name;
    document.getElementById('m-desc').innerText = desc;
    document.getElementById('m-price').innerText = price + " ‚Ç¨";
    document.getElementById('m-img').src = img;
    document.getElementById('qtyVal').innerText = "1";
    
    document.getElementById('optionsForm').reset();
    
    calcTotal();
    document.getElementById('productModal').style.display = 'flex';
}

function closeModal(){
    document.getElementById('productModal').style.display = 'none';
}

function changeQty(delta){
    if(quantity + delta > 0) {
        quantity += delta;
        document.getElementById('qtyVal').innerText = quantity;
        calcTotal();
    }
}

function calcTotal(){
    let total = basePrice;
    const type = document.querySelector('input[name="type"]:checked');
    if(type) total += parseFloat(type.value);

    document.querySelectorAll('.opt-sup:checked').forEach(cb => {
        total += parseFloat(cb.value);
    });

    total = total * quantity;
    document.getElementById('totalBtn').innerText = total.toFixed(2) + " ‚Ç¨";
}

function addToCart(){
    const total = document.getElementById('totalBtn').innerText;
    const type = document.querySelector('input[name="type"]:checked').value > 0 ? "MENU" : "SEUL";
    
    let opts = [];
    document.querySelectorAll('input:checked').forEach(i => {
        const label = i.closest('label').querySelector('.opt-label').innerText;
        if(!label.includes("Seul") && !label.includes("Menu")) opts.push(label);
    });

    const msg = `Commande: ${quantity}x ${currentProduct.name} (${type})\nOptions: ${opts.join(', ')}\nTotal: ${total}`;
    window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
    closeModal();
}

function filterCat(cat){
    document.querySelectorAll('.cat-link').forEach(c => c.classList.remove('active'));
    event.target.classList.add('active');
}

init();
</script>
</body>
</html> 
