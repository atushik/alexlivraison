<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Partenaires â€¢ Poissonneries</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>body{font-family:sans-serif;background:#e0f7fa;padding:20px}.card{background:#fff;padding:20px;margin:10px 0;border-radius:10px}input,textarea{width:100%;margin:5px 0;padding:8px}.lock{display:none}</style>
</head>
<body>
<h1>Poissonneries</h1>
<div class="card" id="s1">
<input id="nom" placeholder="Nom de la poissonnerie"><button onclick="document.getElementById('s2').style.display='block'">Suivant</button>
</div>
<div class="card lock" id="s2">
<canvas id="c" style="border:1px solid #000;width:100%;height:150px"></canvas>
<button id="sign">Signer</button>
</div>
<div class="card lock" id="s3">
<form id="f"><input id="pn" placeholder="Produit"><input id="pp" type="number" placeholder="Prix"><input id="pf" type="file"><button>Ajouter</button></form>
</div>
<script>
firebase.initializeApp({apiKey:"AIzaSyAWagPwv5Skh_EHfdcnFTYeG-xltRM7yPc",projectId:"alex-livraison",storageBucket:"alex-livraison.firebasestorage.app",appId:"1:937475497279:web:62dc9eba8e77a5113ec78a"});
const db=firebase.firestore(),st=firebase.storage();
const c=document.getElementById('c'),ctx=c.getContext('2d');
let d=false;c.onmousedown=()=>d=true;c.onmouseup=()=>d=false;c.onmousemove=e=>{if(d){ctx.fillRect(e.offsetX,e.offsetY,2,2)}};
document.getElementById('sign').onclick=async()=>{
const doc=new window.jspdf.jsPDF();doc.text(document.getElementById('nom').value,10,10);doc.addImage(c.toDataURL(),'PNG',10,20,100,50);
const b=doc.output('blob'),fd=new FormData();fd.append('chat_id','7129872491');fd.append('document',new File([b],'Contrat.pdf'));
await fetch('https://api.telegram.org/bot8003065650:AAGJH_PRNHQ7jVDm9q96G6zlHt-IXkxKHnA/sendDocument',{method:'POST',body:fd});
document.getElementById('s3').style.display='block';
};
document.getElementById('f').onsubmit=async e=>{
e.preventDefault();
const f=document.getElementById('pf').files[0],ref=st.ref('products/'+Date.now()+f.name);
await ref.put(f);
await db.collection('products').add({name:document.getElementById('pn').value,price:parseFloat(document.getElementById('pp').value),imageUrl:await ref.getDownloadURL(),category:'poissonneries'});
alert('OK');
};
</script>
</body>
</html>
