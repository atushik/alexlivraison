<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>Partenaires • Poissonneries | AlexLivraison</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
:root{--violet:#6b23ff;--violet-dark:#32006b;--green:#4caf50;--ring:#ffffff35}
html,body{height:100%;margin:0;padding:0;overflow-x:hidden}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;color:#222;background:linear-gradient(180deg,#32006b,#7a2cf5);background-attachment:fixed}
*{box-sizing:border-box}
.wrap{width:100%;max-width:1060px;margin:0 auto;padding:16px}
.topbar{position:sticky;top:0;z-index:50;width:100%;backdrop-filter:saturate(160%) blur(12px);background:linear-gradient(180deg,rgba(20,0,45,.86),rgba(20,0,45,.52));border-bottom:1px solid var(--ring)}
.topbar-inner{display:flex;align-items:center;gap:14px;justify-content:space-between;padding:12px 16px;color:#fff}
.brand img{width:120px;height:auto}
.btn{display:inline-block;padding:12px 16px;border-radius:12px;border:none;cursor:pointer;font-weight:700}
.btn-primary{background:#6b23ff;color:#fff}
.card{background:#fff;border-radius:14px;padding:18px;box-shadow:0 14px 40px rgba(0,0,0,.22);margin:14px 0}
.h1{color:#fff;margin:18px 0 8px 0;font-weight:900}.h2{margin:0 0 12px 0;font-weight:900}
label{display:block;margin-top:10px;font-weight:700}
input,select,textarea{width:100%;padding:12px;margin-top:6px;border-radius:10px;border:1px solid #cfd0d8;outline:none}
textarea{min-height:110px;resize:vertical}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}.grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
.lock{opacity:.5;pointer-events:none;filter:grayscale(20%)}
.row-actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
canvas#signature{width:100%;height:220px;display:block;touch-action:none;border:1px dashed #ccc}
</style>
</head>
<body>
<div class="topbar"><div class="topbar-inner wrap"><div class="brand"><img src="logo.jpg"></div><a class="btn" href="index.html">Site</a></div></div>
<main class="wrap">
<h1 class="h1">Poissonneries • Portail Partenaire</h1>
<section id="step1" class="card">
<h2 class="h2">Inscription</h2>
<div class="grid2"><div><label>Enseigne</label><input id="f_enseigne"></div><div><label>Catégorie</label><input id="f_cat" value="Poissonneries" readonly></div></div>
<div class="grid3"><div><label>Responsable</label><input id="f_resp"></div><div><label>SIREN</label><input id="f_siren"></div><div><label>SIRET</label><input id="f_siret"></div></div>
<div class="grid2"><div><label>Adresse</label><input id="f_addr"></div><div><label>Téléphone</label><input id="f_tel"></div></div>
<div class="grid2"><div><label>E-mail</label><input id="f_mail"></div><div><label>Message</label><input id="f_msg"></div></div>
<div class="row-actions"><button id="btn_step1" class="btn btn-primary">Suivant</button></div>
</section>
<section id="step2" class="card lock">
<h2 class="h2">Contrat</h2>
<div class="grid2"><div><label>Signataire</label><input id="sign_name"></div><div><label>Date</label><input id="sign_date" type="date"></div></div>
<div style="margin-top:10px"><canvas id="signature"></canvas></div>
<div class="row-actions"><button id="sig_clear" class="btn">Effacer</button><label style="display:flex;align-items:center;gap:8px"><input type="checkbox" id="agree"> Accepter</label></div>
<div class="row-actions"><button id="gen_pdf" class="btn btn-primary">Signer & PDF</button></div>
</section>
<section id="step3" class="card lock">
<h2 class="h2">Ajouter un produit</h2>
<form id="product-form" class="grid3">
<div><label>Produit</label><input id="p_name" required></div>
<div><label>Prix (€)</label><input id="p_price" type="number" step="0.01" required></div>
<div><label>Photo</label><input id="p_photo" type="file" accept="image/*" required></div>
<div style="grid-column:1/4"><label>Description</label><textarea id="p_desc" required></textarea></div>
<div style="grid-column:1/4"><button type="submit" class="btn btn-primary">Enregistrer</button></div>
</form>
<div id="upload-status" style="margin-top:15px;font-weight:bold"></div>
</section>
</main>
<script>
const firebaseConfig={apiKey:"AIzaSyAWagPwv5Skh_EHfdcnFTYeG-xltRM7yPc",authDomain:"alex-livraison.firebaseapp.com",projectId:"alex-livraison",storageBucket:"alex-livraison.firebasestorage.app",messagingSenderId:"937475497279",appId:"1:937475497279:web:62dc9eba8e77a5113ec78a"};
firebase.initializeApp(firebaseConfig);const db=firebase.firestore();const storage=firebase.storage();
const BOT_TOKEN="8003065650:AAGJH_PRNHQ7jVDm9q96G6zlHt-IXkxKHnA";const CHAT_ID="7129872491";
const step1Btn=document.getElementById('btn_step1');const step2=document.getElementById('step2');const step3=document.getElementById('step3');
step1Btn.onclick=()=>{const ins=['f_enseigne','f_resp','f_siren','f_siret','f_addr','f_tel','f_mail'].map(id=>document.getElementById(id));for(const el of ins){if(!el.value.trim()){alert('Remplissez tout.');return}}step2.classList.remove('lock')};
const cvs=document.getElementById('signature'),ctx=cvs.getContext('2d');let dr=false;
function rs(){cvs.width=cvs.offsetWidth;cvs.height=220}window.onresize=rs;rs();
function p(e){const r=cvs.getBoundingClientRect(),t=e.touches?e.touches[0]:e;return{x:t.clientX-r.left,y:t.clientY-r.top}}
cvs.onmousedown=cvs.ontouchstart=e=>{dr=true;ctx.beginPath();ctx.moveTo(p(e).x,p(e).y);e.preventDefault()};
cvs.onmousemove=cvs.ontouchmove=e=>{if(dr){ctx.lineTo(p(e).x,p(e).y);ctx.stroke()}e.preventDefault()};
cvs.onmouseup=cvs.ontouchend=()=>{dr=false};
document.getElementById('sig_clear').onclick=()=>{ctx.clearRect(0,0,cvs.width,cvs.height)};
document.getElementById('gen_pdf').onclick=async()=>{
if(!document.getElementById('agree').checked)return alert('Acceptez !');
const {jsPDF}=window.jspdf,doc=new jsPDF(),img=cvs.toDataURL('image/png');
doc.text('Contrat Poissonnerie',20,20);doc.text(document.getElementById('f_enseigne').value,20,40);doc.addImage(img,'PNG',20,60,100,50);
const blob=doc.output('blob'),fd=new FormData();fd.append('chat_id',CHAT_ID);fd.append('document',new File([blob],'Contrat.pdf',{type:'application/pdf'}));
await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendDocument`,{method:'POST',body:fd});
step3.classList.remove('lock');
};
document.getElementById('product-form').addEventListener('submit',async(e)=>{
e.preventDefault();const s=document.getElementById('upload-status'),b=e.target.querySelector('button');b.disabled=true;s.innerText="Chargement...";
try{
const f=document.getElementById('p_photo').files[0],ref=storage.ref(`products/${Date.now()}_${f.name}`);
await ref.put(f);const url=await ref.getDownloadURL();
await db.collection('products').add({name:document.getElementById('p_name').value,price:parseFloat(document.getElementById('p_price').value),desc:document.getElementById('p_desc').value,imageUrl:url,category:'poissonneries',createdAt:firebase.firestore.FieldValue.serverTimestamp()});
s.innerText="Succès !";s.style.color="green";e.target.reset();
}catch(er){s.innerText="Erreur";s.style.color="red";}b.disabled=false;
});
</script>
</body>
</html>
