<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>Partenaires • Restaurants | AlexLivraison</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
:root{--violet:#6b23ff;}
html,body{height:100%;margin:0;padding:0;font-family:system-ui,-apple-system,sans-serif;background:linear-gradient(180deg,#32006b,#7a2cf5);color:#222}
*{box-sizing:border-box}.wrap{max-width:1060px;margin:0 auto;padding:16px}
.topbar{position:sticky;top:0;z-index:50;background:rgba(20,0,45,.9);border-bottom:1px solid #ffffff33;padding:12px;display:flex;justify-content:space-between;align-items:center}
.brand img{width:120px}.btn{padding:10px 15px;border-radius:8px;border:none;cursor:pointer;font-weight:bold;background:#6b23ff;color:#fff}
.card{background:#fff;border-radius:14px;padding:20px;margin:15px 0;box-shadow:0 10px 30px rgba(0,0,0,.2)}
.h1{color:#fff;margin-top:20px}.grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
input,textarea{width:100%;padding:10px;margin-top:5px;border:1px solid #ccc;border-radius:8px}
.lock{opacity:0.5;pointer-events:none}
canvas{width:100%;height:200px;border:1px dashed #ccc;background:#fff}
</style>
</head>
<body>
<div class="topbar"><div class="brand"><img src="logo.jpg"></div><a href="index.html" class="btn">Site</a></div>
<main class="wrap">
<h1 class="h1">Restaurants • Portail Partenaire</h1>
<section id="step1" class="card">
<h2>Inscription</h2>
<div class="grid2"><div><label>Nom du Restaurant</label><input id="f_enseigne"></div><div><label>Catégorie</label><input id="f_cat" value="Restaurants" readonly></div></div>
<div class="grid2"><div><label>Responsable</label><input id="f_resp"></div><div><label>SIRET</label><input id="f_siret"></div></div>
<div class="grid2"><div><label>Adresse</label><input id="f_addr"></div><div><label>Téléphone</label><input id="f_tel"></div></div>
<input id="f_mail" placeholder="Email"><button class="btn" id="btn_step1" style="margin-top:10px">Suivant</button>
</section>
<section id="step2" class="card lock">
<h2>Contrat</h2>
<input id="sign_name" placeholder="Nom du signataire"><canvas id="signature"></canvas>
<button class="btn" id="sig_clear">Effacer</button> <label><input type="checkbox" id="agree"> Accepter</label>
<button class="btn" id="gen_pdf" style="margin-top:10px">Signer & PDF</button>
</section>
<section id="step3" class="card lock">
<h2>Ajouter un plat</h2>
<form id="product-form">
<input id="p_name" placeholder="Nom du plat" required>
<input id="p_price" type="number" step="0.01" placeholder="Prix (€)" required>
<input id="p_photo" type="file" required>
<textarea id="p_desc" placeholder="Ingrédients..." required></textarea>
<button type="submit" class="btn" style="margin-top:10px">Enregistrer</button>
</form>
<div id="upload-status" style="margin-top:10px;font-weight:bold"></div>
</section>
</main>
<script>
const firebaseConfig={apiKey:"AIzaSyAWagPwv5Skh_EHfdcnFTYeG-xltRM7yPc",authDomain:"alex-livraison.firebaseapp.com",projectId:"alex-livraison",storageBucket:"alex-livraison.firebasestorage.app",messagingSenderId:"937475497279",appId:"1:937475497279:web:62dc9eba8e77a5113ec78a"};
firebase.initializeApp(firebaseConfig);const db=firebase.firestore();const storage=firebase.storage();
const BOT="8003065650:AAGJH_PRNHQ7jVDm9q96G6zlHt-IXkxKHnA",CHAT="7129872491";
document.getElementById('btn_step1').onclick=()=>{document.getElementById('step2').classList.remove('lock')};
const cvs=document.getElementById('signature'),ctx=cvs.getContext('2d');let dr=false;
function rs(){cvs.width=cvs.offsetWidth;cvs.height=200}window.onresize=rs;rs();
function pos(e){const r=cvs.getBoundingClientRect(),t=e.touches?e.touches[0]:e;return{x:t.clientX-r.left,y:t.clientY-r.top}}
cvs.onmousedown=cvs.ontouchstart=e=>{dr=true;ctx.beginPath();ctx.moveTo(pos(e).x,pos(e).y);e.preventDefault()};
cvs.onmousemove=cvs.ontouchmove=e=>{if(dr){ctx.lineTo(pos(e).x,pos(e).y);ctx.stroke()}e.preventDefault()};
cvs.onmouseup=cvs.ontouchend=()=>{dr=false};
document.getElementById('sig_clear').onclick=()=>{ctx.clearRect(0,0,cvs.width,cvs.height)};
document.getElementById('gen_pdf').onclick=async()=>{
if(!document.getElementById('agree').checked)return alert('Acceptez !');
const {jsPDF}=window.jspdf,doc=new jsPDF(),img=cvs.toDataURL('image/png');
doc.text('Contrat Restaurant',20,20);doc.text(document.getElementById('f_enseigne').value,20,40);doc.addImage(img,'PNG',20,60,100,50);
const blob=doc.output('blob'),fd=new FormData();fd.append('chat_id',CHAT);fd.append('document',new File([blob],'Contrat.pdf',{type:'application/pdf'}));
await fetch(`https://api.telegram.org/bot${BOT}/sendDocument`,{method:'POST',body:fd});
document.getElementById('step3').classList.remove('lock');
};
document.getElementById('product-form').onsubmit=async(e)=>{
e.preventDefault();const b=e.target.querySelector('button'),s=document.getElementById('upload-status');
b.disabled=true;s.innerText="Chargement...";
try{
const f=document.getElementById('p_photo').files[0],ref=storage.ref(`products/${Date.now()}_${f.name}`);
await ref.put(f);const url=await ref.getDownloadURL();
await db.collection('products').add({name:document.getElementById('p_name').value,price:parseFloat(document.getElementById('p_price').value),desc:document.getElementById('p_desc').value,imageUrl:url,category:'restaurants',createdAt:firebase.firestore.FieldValue.serverTimestamp()});
s.innerText="OK!";s.style.color="green";e.target.reset();
}catch(err){s.innerText="Erreur";s.style.color="red";}b.disabled=false;
};
</script>
</body>
</html>
