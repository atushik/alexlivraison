<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <meta name="mobile-web-app-capable" content="yes">
  <title>Produits Partenaires | AlexLivraison</title>
  <style>
    :root{--violet:#6b23ff;--violet-dark:#32006b;--green:#4caf50;--ring:#ffffff35}
    html,body{height:100%;margin:0;padding:0;overflow-x:hidden}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;color:#222;background:linear-gradient(180deg,#32006b,#7a2cf5);background-attachment:fixed;display:flex;flex-direction:column;align-items:center}
    *{box-sizing:border-box}
    img{max-width:100%;height:auto;display:block}
    .wrap{width:100%;max-width:1060px;margin:0 auto;padding:16px}
    .topbar{position:sticky;top:0;z-index:50;width:100%;backdrop-filter:saturate(160%) blur(12px);background:linear-gradient(180deg,rgba(20,0,45,.86),rgba(20,0,45,.52));border-bottom:1px solid var(--ring)}
    .topbar-inner{display:flex;align-items:center;gap:14px;justify-content:space-between;padding:12px 16px}
    .brand img{width:120px;height:auto}
    .hamb{width:40px;height:40px;border-radius:10px;display:grid;place-items:center;background:#ffffff12;border:1px solid #ffffff33;cursor:pointer;position:relative}
    .hamb span,.hamb::before,.hamb::after{content:"";position:absolute;width:22px;height:2px;background:#fff;border-radius:2px;transition:.3s}
    .hamb span{top:50%;transform:translateY(-50%)}
    .hamb::before{top:9px}
    .hamb::after{bottom:9px}
    .drawer{position:fixed;inset:0;z-index:60;pointer-events:none}
    .drawer .shade{position:absolute;inset:0;background:#0009;opacity:0;transition:.25s}
    .drawer .panel{position:absolute;left:-280px;top:0;bottom:0;width:280px;background:#14002b;color:#fff;box-shadow:8px 0 30px #0006;padding:18px 14px;display:flex;flex-direction:column;gap:14px;transition:.25s}
    .drawer.open{pointer-events:auto}
    .drawer.open .shade{opacity:1}
    .drawer.open .panel{left:0}
    .drawer a{color:#fff;text-decoration:none;padding:12px;border-radius:10px;background:#ffffff12;border:1px solid #ffffff22;text-align:center}
    .drawer .langs{margin-top:auto;display:flex;gap:8px}
    .drawer .langs button{flex:1;background:#ffffff14;border:1px solid #ffffff33;color:#fff;padding:10px;border-radius:10px;cursor:pointer}
    .hero{padding:28px 16px;color:#fff;text-align:center}
    .h1{color:#fff;margin:4px 0 6px 0;font-weight:900}
    .muted{color:#cfc5ff}
    .controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin:8px 0 10px 0}
    .filters{display:flex;flex-wrap:wrap;gap:8px}
    .chip{background:#ffffff18;color:#fff;border:1px solid #ffffff33;padding:8px 12px;border-radius:999px;cursor:pointer;font-weight:700}
    .chip.active{background:#fff;color:#32006b}
    .search{flex:1;min-width:220px}
    .search input{width:100%;padding:12px;border-radius:12px;border:1px solid #d7d7e4;outline:none}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:14px;margin:12px 0 20px 0}
    .card{background:#fff;border-radius:14px;box-shadow:0 10px 34px rgba(0,0,0,.18);overflow:hidden;display:flex;flex-direction:column}
    .card .pic{height:160px;background:#f4f4fb;display:grid;place-items:center}
    .card .pic img{width:100%;height:100%;object-fit:cover}
    .card .body{padding:12px 14px}
    .title{font-weight:900}
    .desc{opacity:.8;font-size:14px;margin-top:4px;min-height:40px}
    .row{display:flex;align-items:center;justify-content:space-between;margin-top:10px}
    .price{font-weight:900}
    .btn{display:inline-flex;align-items:center;justify-content:center;padding:10px 12px;border-radius:12px;border:none;cursor:pointer}
    .btn-primary{background:#6b23ff;color:#fff}
    .btn-ghost{background:#ececf4}
    .footer{color:#cfc5ff;text-align:center;margin:18px 0 26px 0}
    @media(max-width:900px){.wrap{padding:12px}}
  </style>
</head>
<body>
  <div class="topbar">
    <div class="topbar-inner wrap">
      <div class="brand"><img src="logo.jpg" alt="AlexLivraison"></div>
      <div class="hamb" id="btn-menu"><span></span></div>
    </div>
  </div>
  <div class="drawer" id="drawer">
    <div class="shade" id="shade"></div>
    <div class="panel">
      <img src="logo.jpg" alt="AlexLivraison" style="width:120px;height:auto;margin-bottom:10px">
      <a href="index.html">Accueil / Commander</a>
      <a href="supermarches.html" target="_blank">Partenaires – Supermarchés</a>
      <a href="restaurants.html" target="_blank">Partenaires – Restaurants</a>
      <a href="pharmacies.html" target="_blank">Partenaires – Pharmacies</a>
      <a href="boulangeries.html" target="_blank">Partenaires – Boulangeries</a>
      <div class="langs">
        <button id="btn-fr">FR</button>
        <button id="btn-en">EN</button>
      </div>
    </div>
  </div>
  <header class="hero wrap">
    <div class="muted" id="hero-eyebrow">Catalogue</div>
    <h1 class="h1" id="hero-title">Produits Partenaires</h1>
    <div class="muted" id="hero-desc">Trouvez vos produits partenaires et commandez facilement.</div>
  </header>
  <main class="wrap">
    <div class="controls">
      <div class="filters" id="filters"></div>
      <div class="search">
        <input id="q" placeholder="Rechercher un produit…">
      </div>
    </div>
    <div class="grid" id="grid"></div>
  </main>
  <div class="footer">© AlexLivraison</div>
  <script>
    const drawer=document.getElementById('drawer');
    const shade=document.getElementById('shade');
    const btnMenu=document.getElementById('btn-menu');
    btnMenu.addEventListener('click',()=>drawer.classList.add('open'));
    shade.addEventListener('click',()=>drawer.classList.remove('open'));

    const partnerPages = ['supermarches.html', 'boulangeries.html', 'pharmacies.html', 'restaurants.html', 'epiceries.html', 'commercants.html'];
    let productsData = [];
    const grid = document.getElementById('grid');
    const filters = document.getElementById('filters');
    const q = document.getElementById('q');
    let activeCat = 'all';

    function formatPrice(v){return (Number(v).toFixed(2)+' €').replace('.',',')}

    async function loadPartnerProducts(url) {
      const res = await fetch(url);
      const text = await res.text();
      const parser = new DOMParser();
      const doc = parser.parseFromString(text, 'text/html');
      // Адаптировать селектор под структуру партнерских html
      const items = Array.from(doc.querySelectorAll('.card'));
      const partnerProducts = items.map(item => {
        return {
          name: item.querySelector('.title')?.textContent.trim() || '',
          price: parseFloat((item.querySelector('.price')?.textContent || '0').replace(/[^\d,\.]/g,'').replace(',', '.')) || 0,
          img: item.querySelector('.pic img')?.src || '',
          cat: url.replace('.html','') || 'Sans catégorie'
        };
      });
      return partnerProducts;
    }

    async function loadAllPartners() {
      const allProducts = [];
      for(const url of partnerPages){
        try{
          const partnerProducts = await loadPartnerProducts(url);
          allProducts.push(...partnerProducts);
        }catch(e){
          console.error(`Failed to load ${url}`, e);
        }
      }
      return allProducts;
    }

    function setFilters(){
      const cats = Array.from(new Set(productsData.map(p=>p.cat)));
      filters.innerHTML = '';
      const btnAll = document.createElement('button');
      btnAll.className = 'chip active';
      btnAll.dataset.cat = 'all';
      btnAll.textContent = 'Tous';
      filters.appendChild(btnAll);
      cats.forEach(c=>{
        const btn=document.createElement('button');
        btn.className='chip';
        btn.dataset.cat=c;
        btn.textContent=c;
        filters.appendChild(btn);
      });
    }

    filters.addEventListener('click', e => {
      if(e.target.classList.contains('chip')){
        document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
        e.target.classList.add('active');
        activeCat=e.target.dataset.cat||'all';
        render();
      }
    });
    q.addEventListener('input', render);

    function render(){
      const term=q.value.trim().toLowerCase();
      grid.innerHTML='';
      productsData
        .filter(p => activeCat==='all' || p.cat === activeCat)
        .filter(p => !term || p.name.toLowerCase().includes(term))
        .forEach(p => {
          const card = document.createElement('div');
          card.className = 'card';
          const pic = document.createElement('div');
          pic.className = 'pic';
          const im = document.createElement('img');
          im.src = p.img;
          im.alt = p.name;
          pic.appendChild(im);
          const body = document.createElement('div');
          body.className = 'body';
          const title = document.createElement('div');
          title.className = 'title';
          title.textContent = p.name;
          const price = document.createElement('div');
          price.className = 'price';
          price.textContent = formatPrice(p.price);
          body.appendChild(title);
          body.appendChild(price);
          card.appendChild(pic);
          card.appendChild(body);
          grid.appendChild(card);
        });
    }

    async function init(){
      productsData = await loadAllPartners();
      setFilters();
      render();
    }

    init();
  </script>
</body>
</html>
