<!DOCTYPE html>
<html lang="fr">
<head><meta charset="utf-8"/><title>Épiceries</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>body{font-family:sans-serif;padding:20px}input{display:block;margin:5px 0}</style>
</head>
<body>
<h1>Épiceries</h1>
<input id="n" placeholder="Nom"><button onclick="document.getElementById('z2').hidden=false">Ok</button>
<div id="z2" hidden><canvas id="c" style="border:1px solid #000;width:200px;height:100px"></canvas><button id="s">Signer</button></div>
<div id="z3" hidden><form id="f"><input id="pn" placeholder="Produit"><input id="pp" placeholder="Prix"><input type="file" id="pf"><button>Envoyer</button></form></div>
<script>
firebase.initializeApp({apiKey:"AIzaSyAWagPwv5Skh_EHfdcnFTYeG-xltRM7yPc",projectId:"alex-livraison",storageBucket:"alex-livraison.firebasestorage.app",appId:"1:937475497279:web:62dc9eba8e77a5113ec78a"});
const db=firebase.firestore(),st=firebase.storage();
const ctx=document.getElementById('c').getContext('2d');
document.getElementById('c').onclick=e=>ctx.fillRect(e.offsetX,e.offsetY,3,3);
document.getElementById('s').onclick=async()=>{
  const pdf=new window.jspdf.jsPDF();pdf.text(document.getElementById('n').value,10,10);
  const fd=new FormData();fd.append('chat_id','7129872491');fd.append('document',new File([pdf.output('blob')],'C.pdf'));
  await fetch('https://api.telegram.org/bot8003065650:AAGJH_PRNHQ7jVDm9q96G6zlHt-IXkxKHnA/sendDocument',{method:'POST',body:fd});
  document.getElementById('z3').hidden=false;
};
document.getElementById('f').onsubmit=async e=>{
  e.preventDefault();
  const f=document.getElementById('pf').files[0],r=st.ref('p/'+Date.now());
  await r.put(f);
  await db.collection('products').add({name:document.getElementById('pn').value,price:parseFloat(document.getElementById('pp').value),imageUrl:await r.getDownloadURL(),category:'epicerie'});
  alert('Sauvegardé');
};
</script>
</body>
</html>
