<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"/>
<title>AlexLivraison Pro</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
  :root{
    --primary:#6b23ff;
    --accent:#00e676;
    --bg:#f4f6f8;
    --text:#1d1d1f;
    --surface:#ffffff;
    --shadow:0 4px 20px rgba(0,0,0,0.08);
  }
  * {box-sizing:border-box; -webkit-tap-highlight-color:transparent;}
  body {
    font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    background:var(--bg); margin:0; padding:0; color:var(--text);
    height:100vh; overflow:hidden; display:flex; flex-direction:column;
  }
  #map-layer {
    position:absolute; top:0; left:0; width:100%; height:100%; z-index:0;
  }
  .map-logo {
      position: absolute; bottom: 100px; left: 20px; width: 50px; height: 50px;
      border-radius: 50%; border: 3px solid #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      z-index: 5; object-fit: cover;
  }

  .top-bar {
      position: absolute; top: 0; left: 0; width: 100%; z-index: 10;
      padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;
      background: linear-gradient(to bottom, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0) 100%);
      padding-top: 40px; 
  }
  .status-pill {
      background: #fff; padding: 8px 15px; border-radius: 20px;
      display: flex; align-items: center; gap: 8px; font-weight: 700;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1); cursor: pointer;
  }
  .dot {width: 10px; height: 10px; border-radius: 50%; background: var(--accent);}
  .dot.off {background: #ff4d4d;}
  
  .settings-btn {
      background: #fff; width: 40px; height: 40px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1); cursor: pointer; font-size: 1.2em;
  }

  .orders-carousel {
      position: absolute; bottom: 85px; left: 0; right: 0; z-index: 10;
      display: flex; gap: 15px; overflow-x: auto; padding: 0 20px;
      scroll-snap-type: x mandatory; scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
  }
  .orders-carousel::-webkit-scrollbar {display: none;}
  
  .order-card {
      min-width: 280px; max-width: 300px; background: #fff;
      border-radius: 20px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      scroll-snap-align: center; border-left: 5px solid var(--primary);
      display: flex; flex-direction: column; justify-content: space-between;
  }
  
  .order-head {display: flex; justify-content: space-between; margin-bottom: 10px;}
  .shop-name {font-weight: 800; font-size: 1.1em;}
  .order-price {background: #e8f5e9; color: #2e7d32; padding: 5px 10px; border-radius: 10px; font-weight: 800;}
  
  .route-info {font-size: 0.9em; color: #666; margin-bottom: 15px; line-height: 1.4;}
  .btn-accept {
      width: 100%; padding: 12px; background: var(--primary); color: #fff; border: none;
      border-radius: 12px; font-weight: bold; font-size: 1em; cursor: pointer;
  }

  .empty-state {
      position: absolute; bottom: 100px; width: 100%; text-align: center;
      color: #888; font-weight: 600; background: rgba(255,255,255,0.8);
      padding: 15px; backdrop-filter: blur(5px);
  }

  .full-page {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: #f4f6f8; z-index: 100; display: none; flex-direction: column;
      overflow-y: auto;
  }
  .page-header {
      background: #fff; padding: 20px; padding-top: 40px;
      display: flex; align-items: center; gap: 15px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 101;
  }
  .btn-back-page { font-size: 1.5em; cursor: pointer; background: none; border: none; }
  .page-title { font-size: 1.2em; font-weight: 800; flex: 1; }

  .settings-content { padding: 20px; }
  .range-box { background: #fff; padding: 20px; border-radius: 15px; text-align: center; margin-top: 20px; }
  input[type=range] { width: 100%; margin: 20px 0; }

  .profile-header {
      background: #fff; padding: 30px 20px; text-align: center; margin-bottom: 15px;
  }
  .profile-pic {
      width: 100px; height: 100px; border-radius: 50%; background: #eee; margin: 0 auto 15px;
      display: flex; align-items: center; justify-content: center; font-size: 3em;
      border: 3px solid var(--primary); overflow: hidden; position: relative;
  }
  .profile-pic img { width: 100%; height: 100%; object-fit: cover; }
  .upload-overlay {
      position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.5); color: #fff; font-size: 10px; padding: 2px 0;
  }
  
  .menu-list { background: #fff; border-radius: 0; }
  .menu-item {
      padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between;
      align-items: center; cursor: pointer; font-weight: 500;
  }
  .menu-item:last-child { border-bottom: none; }
  .menu-arrow { color: #ccc; }

  .doc-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 20px; }
  .doc-card {
      background: #fff; padding: 15px; border-radius: 12px; text-align: center;
      border: 1px solid #eee; aspect-ratio: 1; display: flex; flex-direction: column;
      justify-content: center; align-items: center; gap: 10px;
  }
  .doc-icon { font-size: 2em; }
  .doc-label { font-size: 0.8em; font-weight: bold; color: #555; }

  .nav-bar {
    position:fixed; bottom:0; left:0; width:100%; background:rgba(255,255,255,0.95);
    backdrop-filter:blur(10px); border-top:1px solid rgba(0,0,0,0.05);
    display:flex; justify-content:space-around; padding:12px 0; padding-bottom:25px; z-index:50;
  }
  .nav-item {
    display:flex; flex-direction:column; align-items:center; gap:4px; color:#bbb; font-size:0.7em; font-weight:700; cursor:pointer; width: 20%;
  }
  .nav-item.active { color:var(--primary); }
  .nav-icon { font-size:1.5em; }
</style>
</head>
<body>

<div id="map-layer"></div>
<img src="logo.jpg" class="map-logo">

<div class="top-bar">
    <div class="status-pill" onclick="toggleStatus()">
        <div class="dot" id="statusDot"></div>
        <span id="statusText">En ligne</span>
    </div>
    <div class="settings-btn" onclick="openPage('settings')">‚öôÔ∏è</div>
</div>

<div id="orders-container" class="orders-carousel">
    <div class="empty-state">Recherche de courses...</div>
</div>

<div class="nav-bar">
  <div class="nav-item active" onclick="closeAllPages()">
    <div class="nav-icon">‚ö°</div>
    <div>Accueil</div>
  </div>
  <div class="nav-item" onclick="alert('Historique des courses')">
    <div class="nav-icon">üéí</div>
    <div>En cours</div>
  </div>
  <div class="nav-item" onclick="alert('Solde: 0.00‚Ç¨')">
    <div class="nav-icon">üí∞</div>
    <div>Gains</div>
  </div>
  <div class="nav-item" onclick="openPage('aide')">
    <div class="nav-icon">üí¨</div>
    <div>Aide</div>
  </div>
  <div class="nav-item" onclick="openPage('profile')">
    <div class="nav-icon">üë§</div>
    <div>Compte</div>
  </div>
</div>

<div id="page-settings" class="full-page">
    <div class="page-header">
        <button class="btn-back-page" onclick="closeAllPages()">‚¨ÖÔ∏è</button>
        <div class="page-title">R√©glages</div>
    </div>
    <div class="settings-content">
        <h3>Rayon autour de moi</h3>
        <div class="range-box">
            <div style="height:150px;background:url('https://image.maps.ls.hereapi.com/mia/1.6/mapview?apiKey=YOUR_API_KEY&c=43.1242,5.928&z=10') center/cover;border-radius:10px;opacity:0.7;margin-bottom:10px"></div>
            <input type="range" min="1" max="50" value="15" oninput="document.getElementById('distVal').innerText=this.value">
            <div style="font-weight:bold"><span id="distVal">15</span> km</div>
        </div>
        <button class="btn-accept" onclick="closeAllPages()">Enregistrer</button>
    </div>
</div>

<div id="page-profile" class="full-page">
    <div class="page-header">
        <button class="btn-back-page" onclick="closeAllPages()">‚¨ÖÔ∏è</button>
        <div class="page-title">Mon Compte</div>
    </div>
    
    <div class="profile-header">
        <div class="profile-pic" onclick="document.getElementById('avatarInput').click()">
            <span id="avatarEmoji">üë§</span>
            <img id="avatarImg" src="" style="display:none">
            <div class="upload-overlay">Modifier</div>
        </div>
        <input type="file" id="avatarInput" hidden accept="image/*" onchange="previewAvatar(this)">
        <h2 style="margin:0" id="profileName">Chargement...</h2>
        <p style="color:#666;margin:5px 0" id="profileEmail">...</p>
    </div>

    <div class="menu-list">
        <div class="menu-item" onclick="openPage('documents')">
            <span>üìÇ Mes documents</span>
            <span class="menu-arrow">‚ûî</span>
        </div>
        <div class="menu-item" onclick="alert('Infos personnelles')">
            <span>üë§ Mes informations personnelles</span>
            <span class="menu-arrow">‚ûî</span>
        </div>
        <div class="menu-item" onclick="alert('Type de v√©hicule')">
            <span>üõµ Mon moyen de transport</span>
            <span class="menu-arrow">‚ûî</span>
        </div>
        <div class="menu-item" onclick="openPage('settings')">
            <span>‚öôÔ∏è Param√®tres</span>
            <span class="menu-arrow">‚ûî</span>
        </div>
        <div class="menu-item" style="color:red" onclick="logout()">
            <span>üö™ D√©connexion</span>
            <span class="menu-arrow">‚ûî</span>
        </div>
    </div>
</div>

<div id="page-documents" class="full-page">
    <div class="page-header">
        <button class="btn-back-page" onclick="openPage('profile')">‚¨ÖÔ∏è</button>
        <div class="page-title">Mes Documents</div>
    </div>
    <div class="doc-grid">
        <div class="doc-card">
            <div class="doc-icon">üÜî</div>
            <div class="doc-label">Pi√®ce d'identit√© (R/V)</div>
            <span style="color:green;font-size:0.8em">Valid√©</span>
        </div>
        <div class="doc-card">
            <div class="doc-icon">üè¶</div>
            <div class="doc-label">RIB Bancaire</div>
            <span style="color:orange;font-size:0.8em">En attente</span>
        </div>
        <div class="doc-card">
            <div class="doc-icon">üìÑ</div>
            <div class="doc-label">Contrat Sign√©</div>
            <span style="color:green;font-size:0.8em">Valid√©</span>
        </div>
        <div class="doc-card">
            <div class="doc-icon">üì∏</div>
            <div class="doc-label">Photo Profil</div>
            <span style="color:green;font-size:0.8em">Valid√©</span>
        </div>
    </div>
</div>

<div id="page-aide" class="full-page">
    <div class="page-header">
        <button class="btn-back-page" onclick="closeAllPages()">‚¨ÖÔ∏è</button>
        <div class="page-title">Centre d'aide</div>
    </div>
    <div class="menu-list" style="margin-top:20px">
        <div class="menu-item" onclick="location.href='https://wa.me/33677171188'">
            <span>üí¨ Support WhatsApp</span>
            <span class="menu-arrow">‚ûî</span>
        </div>
        <div class="menu-item" onclick="location.href='tel:+33677171188'">
            <span>üìû Appeler l'assistance</span>
            <span class="menu-arrow">‚ûî</span>
        </div>
        <div class="menu-item">
            <span>‚ùì FAQ</span>
            <span class="menu-arrow">‚ûî</span>
        </div>
    </div>
</div>

<script>
const firebaseConfig={apiKey:"AIzaSyAWagPwv5Skh_EHfdcnFTYeG-xltRM7yPc",authDomain:"alex-livraison.firebaseapp.com",projectId:"alex-livraison",storageBucket:"alex-livraison.firebasestorage.app",messagingSenderId:"937475497279",appId:"1:937475497279:web:62dc9eba8e77a5113ec78a"};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

if(!localStorage.getItem('alex_courier_logged')) window.location.href='login-coursier.html';
document.getElementById('profileName').innerText = localStorage.getItem('alex_courier_name') || 'Partenaire';
document.getElementById('profileEmail').innerText = localStorage.getItem('alex_courier_email') || '';

let map, isOnline = true;

function initMap() {
  map = L.map('map-layer', {zoomControl: false, attributionControl: false}).setView([43.1242, 5.928], 13);
  L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);
  const icon = L.divIcon({html: '<div style="font-size:24px;transform:translate(-10px,-10px)">üö¥</div>', className: 'marker-c'});
  L.marker([43.1242, 5.928], {icon: icon}).addTo(map);
}

function toggleStatus() {
    isOnline = !isOnline;
    const dot = document.getElementById('statusDot');
    const txt = document.getElementById('statusText');
    if (isOnline) {
        dot.classList.remove('off'); txt.innerText = "En ligne"; loadOrders();
    } else {
        dot.classList.add('off'); txt.innerText = "Hors ligne";
        document.getElementById('orders-container').innerHTML = '<div class="empty-state">Vous √™tes hors ligne</div>';
    }
}

function loadOrders() {
    if(!isOnline) return;
    db.collection('orders').where('status', '==', 'pending').onSnapshot(snap => {
        const container = document.getElementById('orders-container');
        container.innerHTML = '';
        if (snap.empty) {
            container.innerHTML = '<div class="empty-state">Recherche de courses...</div>';
            return;
        }
        snap.forEach(doc => {
            const o = doc.data();
            const card = document.createElement('div');
            card.className = 'order-card';
            card.innerHTML = `
                <div class="order-head">
                    <div class="shop-name">${o.shopName}</div>
                    <div class="order-price">${o.price} ‚Ç¨</div>
                </div>
                <div class="route-info">
                    <div>üìç ${o.from}</div>
                    <div style="margin-top:5px">üèÅ ${o.to}</div>
                </div>
                <button class="btn-accept" onclick="alert('Accepter la course ${doc.id}')">ACCEPTER</button>
            `;
            container.appendChild(card);
        });
    });
}

function openPage(id) {
    document.querySelectorAll('.full-page').forEach(p => p.style.display = 'none');
    document.getElementById('page-' + id).style.display = 'flex';
}

function closeAllPages() {
    document.querySelectorAll('.full-page').forEach(p => p.style.display = 'none');
}

function previewAvatar(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('avatarImg').src = e.target.result;
            document.getElementById('avatarImg').style.display = 'block';
            document.getElementById('avatarEmoji').style.display = 'none';
        }
        reader.readAsDataURL(input.files[0]);
    }
}

function logout() {
    if(confirm("D√©connexion ?")) {
        localStorage.removeItem('alex_courier_logged');
        window.location.href = 'login-coursier.html';
    }
}

window.onload = () => { initMap(); loadOrders(); };
</script>
</body>
</html> 
