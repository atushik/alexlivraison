<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üöóAlexLivraisonüö¥üèª‚Äç‚ôÇÔ∏è</title>
  <style>
    body {
      font-family: "Poppins", sans-serif;
      margin: 0;
      background: linear-gradient(135deg, #5e2ced, #8b52ff);
      background-attachment: fixed;
      color: #222;
    }
    .container {
      max-width: 500px;
      margin: 40px auto;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }
    h1 {
      text-align: center;
      color: #5e2ced;
      font-size: 28px;
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-top: 12px;
      font-weight: 500;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    button {
      width: 100%;
      margin-top: 15px;
      padding: 12px;
      border: none;
      border-radius: 10px;
      background: #7a35ff;
      color: white;
      font-size: 16px;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover { background: #5e2ced; }
    #map {
      height: 250px;
      border-radius: 10px;
      margin-top: 20px;
    }
    footer {
      text-align: center;
      font-size: 14px;
      margin-top: 20px;
      color: white;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üöóAlexLivraisonüö¥üèª‚Äç‚ôÇÔ∏è</h1>

    <label>Adresse de d√©part</label>
    <input id="start" placeholder="Ex: 2 Rue Beaussier, Toulon" />

    <label>Adresse de destination</label>
    <input id="end" placeholder="Ex: 241 Rue Le Corbusier, La Seyne-sur-Mer" />

    <label>Taille du colis üì¶</label>
    <select id="size">
      <option value="S">Petit (S)</option>
      <option value="M">Moyen (M)</option>
      <option value="L">Grand (L)</option>
      <option value="XL">Tr√®s grand (XL)</option>
    </select>

    <label>√âtage (optionnel)</label>
    <select id="floor">
      <option value="0">RDC / 1er (0 ‚Ç¨)</option>
      <option value="2">2e √† 4e (+2 ‚Ç¨)</option>
      <option value="5">5e √† 10e (+3 ‚Ç¨)</option>
      <option value="11">11e et plus (+4 ‚Ç¨)</option>
    </select>

    <label>Services additionnels</label>
    <div>
      <label><input type="checkbox" class="extra" value="2" /> Colis fragile (+2 ‚Ç¨)</label><br>
      <label><input type="checkbox" class="extra" value="3" /> Livraison urgente (+3 ‚Ç¨)</label><br>
      <label><input type="checkbox" class="extra" value="1" /> Attente 5 min (+1 ‚Ç¨)</label><br>
      <label><input type="checkbox" class="extra" value="2" /> Attente 10 min (+2 ‚Ç¨)</label>
    </div>

    <label>Heure de livraison souhait√©e</label>
    <input type="datetime-local" id="time" />

    <button onclick="calculatePrice()">üßÆ Calculer le prix</button>
    <div id="result"></div>
    <button id="payCard" style="display:none;" onclick="payByCard()">üí≥ Paiement par carte</button>
    <button id="payCash" style="display:none;" onclick="alert('Paiement en esp√®ces accept√© √† la livraison.')">üí∂ Paiement en esp√®ces</button>

    <div id="map"></div>
  </div>

  <footer>üíú Nous livrons vos commandes jusqu‚Äô√† votre porte ¬© 2025 AlexLivraison</footer>

  <script>
    let map;
    let markerA, markerB;
    const mapKey = "AIzaSyC6bP1-fake-key-for-demo"; // –∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π –∫–ª—é—á Google Maps API

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 43.118, lng: 5.933 },
        zoom: 11,
      });
    }

    async function calculatePrice() {
      const start = document.getElementById("start").value;
      const end = document.getElementById("end").value;
      if (!start || !end) {
        alert("Veuillez entrer les deux adresses !");
        return;
      }

      const size = document.getElementById("size").value;
      const floor = parseInt(document.getElementById("floor").value);
      const extras = Array.from(document.querySelectorAll(".extra:checked")).map(e => parseFloat(e.value));
      const extraCost = extras.reduce((a,b)=>a+b,0);

      // API Distance Matrix
      const url = https://maps.googleapis.com/maps/api/distancematrix/json?origins=${encodeURIComponent(start)}&destinations=${encodeURIComponent(end)}&key=${mapKey};
      const response = await fetch(https://api.allorigins.win/get?url=${encodeURIComponent(url)});
      const data = await response.json();
      const result = JSON.parse(data.contents);

      if (!result.rows[0] || !result.rows[0].elements[0].distance) {
        alert("Erreur lors du calcul. V√©rifiez les adresses.");
        return;
      }

      const distanceKm = result.rows[0].elements[0].distance.value / 1000;
      let basePrice = 1.5 + distanceKm * 0.8;

      if (size === "M") basePrice += 0.8;
      else if (size === "L") basePrice += 1.5;
      else if (size === "XL") basePrice += 2.5;

      const floorCost = floor === 0 ? 0 : floor <= 4 ? 2 : floor <= 10 ? 3 : 4;
      const total = (basePrice + extraCost + floorCost).toFixed(2);

      document.getElementById("result").innerHTML = üìè Distance : ${distanceKm.toFixed(2)} km<br>üí∞ Prix total : ${total} ‚Ç¨;
      document.getElementById("payCard").style.display = "block";
      document.getElementById("payCash").style.display = "block";

      if (map) {
        const geocoder = new google.maps.Geocoder();
        geocoder.geocode({ address: start }, (res1) => {
          geocoder.geocode({ address: end }, (res2) => {
            if (res1[0] && res2[0]) {
              const locA = res1[0].geometry.location;
              const locB = res2[0].geometry.location;
              if (markerA) markerA.setMap(null);
              if (markerB) markerB.setMap(null);
              markerA = new google.maps.Marker({ position: locA, map, label: "A" });
              markerB = new google.maps.Marker({ position: locB, map, label: "B" });
              map.setCenter(locA);
            }
          });
        });
      }
    }

    function payByCard() {
      const totalText = document.getElementById("result").innerText.match(/(\d+(\.\d+)?)/);
      const amount = totalText ? totalText[0] : 0;
      window.open(https://checkout.revolut.com/pay/10d5b369-d7f0-43cb-a810-af4c7afe9d27?amount=${amount}&currency=EUR, "_blank");
    }
  </script>

  <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC6bP1-fake-key-for-demo&callback=initMap"></script>
</body>
</html>
