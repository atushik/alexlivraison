<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Alex Livraison üöóüö¥‚Äç‚ôÇÔ∏è</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(180deg, #6a00ff, #8b5cf6);
      color: white;
      text-align: center;
      padding: 20px;
    }
    h1 {
      font-size: 28px;
    }
    .form {
      background: white;
      color: black;
      padding: 20px;
      border-radius: 14px;
      max-width: 400px;
      margin: auto;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    button {
      background: #6a00ff;
      color: white;
      font-weight: bold;
      border: none;
      cursor: pointer;
    }
    button.secondary {
      background: #00a86b;
    }
    .note {
      font-size: 14px;
      margin-top: 20px;
    }
    .result {
      font-weight: bold;
      margin-top: 10px;
      font-size: 18px;
    }
    .success {
      color: #00ff9d;
      font-weight: bold;
      margin-top: 10px;
    }
    .error {
      color: #ff4747;
      font-weight: bold;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>Alex Livraison üöóüö¥‚Äç‚ôÇÔ∏è</h1>

  <div class="form">
    <label>Adresse de d√©part</label>
    <input type="text" id="from" placeholder="Ex: 241 Rue le Corbusier, La Seyne-sur-Mer" />

    <label>Adresse de destination</label>
    <input type="text" id="to" placeholder="Ex: 2 Rue Beaussier, Toulon" />

    <label>Taille du colis üì¶</label>
    <select id="size">
      <option value="S">Petit (S)</option>
      <option value="M">Moyen (M)</option>
      <option value="L">Large (L)</option>
      <option value="XL">Tr√®s grand (XL)</option>
    </select>

    <label>Heure de livraison souhait√©e</label>
    <input type="datetime-local" id="time" />

    <button id="calc">Calculer le prix</button>
    <div id="result" class="result"></div>

    <button id="pay-card">üí≥ Paiement par carte (Revolut)</button>
    <button id="pay-cash" class="secondary">üí∂ Paiement en esp√®ces √† la livraison</button>
    <div id="send-status"></div>
  </div>

  <p class="note">
    üö¥ Livraison locale 24h/24 et 7j/7 ‚Äî repas, courses, m√©dicaments et colis dans tout le Var.<br />
    üíú ¬© 2025 Alex Livraison
  </p>

  <script>
    const API_URL = "https://alexlivraison-api.onrender.com/api/notify-whatsapp";
    const REVOLUT_LINK = "https://checkout.revolut.com/pay/10d5b369-d7f0-43cb-a810-af4c7afe9d27";

    // ---- Configuration tarifs ----
    const PRICING = {
      BASE_FEE: 3.0,
      PER_KM: 0.80,
      SIZE_MULT: { S: 1.0, M: 1.2, L: 1.5, XL: 1.8 },
      MIN_PRICE: 5.0,
    };

    // Fonction de calcul (simplifi√©e)
    async function calculatePrice() {
      const from = document.getElementById("from").value.trim();
      const to = document.getElementById("to").value.trim();
      if (!from || !to) {
        document.getElementById("result").innerHTML = "‚ö†Ô∏è Merci de saisir les deux adresses.";
        return;
      }
      const distanceKm = (Math.random() * 10 + 2).toFixed(2); // simulation
      const size = document.getElementById("size").value;
      let prix = Math.max(PRICING.MIN_PRICE, (PRICING.BASE_FEE + PRICING.PER_KM * distanceKm) * PRICING.SIZE_MULT[size]);
      prix = prix.toFixed(2);
      document.getElementById("result").innerHTML = `üöö Distance estim√©e : <b>${distanceKm} km</b><br>üí∂ Prix estim√© : <b>${prix} ‚Ç¨</b>`;
      return { from, to, distanceKm, prix };
    }

    // Envoi WhatsApp + confirmation
    async function notifyAndConfirm(order) {
      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(order),
        });
        if (res.ok) {
          document.getElementById("send-status").innerHTML = "‚úÖ Notification WhatsApp envoy√©e.";
          setTimeout(() => {
            document.getElementById("send-status").innerHTML = "‚úÖ Votre commande a √©t√© activ√©e avec succ√®s !";
            document.getElementById("send-status").className = "success";
          }, 1000);
        } else {
          document.getElementById("send-status").innerHTML = "‚ùå Erreur d'envoi WhatsApp.";
          document.getElementById("send-status").className = "error";
        }
      } catch {
        document.getElementById("send-status").innerHTML = "‚ö†Ô∏è Probl√®me de connexion avec l‚ÄôAPI.";
        document.getElementById("send-status").className = "error";
      }
    }

    document.getElementById("calc").addEventListener("click", calculatePrice);

    document.getElementById("pay-card").addEventListener("click", async () => {
      const order = await calculatePrice();
      if (!order) return;
      notifyAndConfirm(order);
      setTimeout(() => window.open(REVOLUT_LINK, "_blank"), 1500);
    });

    document.getElementById("pay-cash").addEventListener("click", async () => {
      const order = await calculatePrice();
      if (!order) return;
      notifyAndConfirm(order);
    });
  </script>
</body>
</html>
