<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Alex Livraison üöóüö¥‚Äç‚ôÇÔ∏è</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    body {
      margin: 0;
      font-family: system-ui, Arial, sans-serif;
      background: radial-gradient(circle at top, #5f0fb6, #33006f);
      color: #222;
    }
    .container {
      max-width: 680px;
      margin: 0 auto;
      padding: 30px 15px 100px;
    }
    .title {
      color: white;
      font-size: 38px;
      font-weight: 800;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .card {
      background: #fff;
      border-radius: 20px;
      padding: 20px;
      margin-top: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    label { font-weight: 700; margin-top: 10px; display: block; }
    input, select {
      width: 100%;
      height: 50px;
      border: 1px solid #ddd;
      border-radius: 12px;
      padding: 0 12px;
      font-size: 17px;
      margin-top: 5px;
    }
    .btn {
      width: 100%;
      height: 55px;
      font-weight: 700;
      font-size: 18px;
      border: none;
      border-radius: 14px;
      margin-top: 15px;
      cursor: pointer;
      color: #fff;
      background: #5f0fb6;
      box-shadow: 0 6px 20px rgba(95,15,182,0.4);
    }
    .btn:active { background: #4e0c95; }
    .btn-outline { background: #ddd; color: #222; box-shadow: none; }
    #map { height: 300px; margin-top: 20px; border-radius: 14px; }
    .result { margin-top: 10px; background: #fafafa; border-radius: 10px; padding: 10px; font-weight: 600; }
    .hidden { display: none; }
    .footer { color: #eee; text-align: center; margin-top: 20px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="title">Alex Livraison üöóüö¥‚Äç‚ôÇÔ∏è</div>
    <div class="card">
      <label>Adresse de d√©part</label>
      <input id="from" placeholder="Ex: 2 Rue Beaussier, Toulon">
      <label>Adresse de destination</label>
      <input id="to" placeholder="Ex: 241 Rue Le Corbusier, La Seyne">
      <label>Taille du colis üì¶</label>
      <select id="size">
        <option value="S">Petit (S)</option>
        <option value="M">Moyen (M)</option>
        <option value="L">Grand (L)</option>
        <option value="XL">Tr√®s grand (XL)</option>
      </select>
      <label>Heure de livraison souhait√©e</label>
      <select id="time"></select>
      <button id="calc" class="btn">üßÆ Calculer le prix</button>
      <button id="payCard" class="btn">üí≥ Paiement par carte</button>
      <button id="payCash" class="btn btn-outline">üí∑ Paiement en esp√®ces</button>
      <div id="result" class="result hidden"></div>
      <div id="map" class="hidden"></div>
    </div>
    <p class="footer">üö¥ Livraison locale 24h/24 et 7j/7 ‚Äî Var (Toulon, La Seyne, Ollioules, etc.)<br>üíú ¬© 2025 Alex Livraison</p>
  </div>

  <script>
  (function(){
    var PRICE_PER_KM = 0.9;
    var REVOLUT_LINK = "https://checkout.revolut.com/pay/10d5b369-d7f0-43cb-a810-af4c7afe9d27";
    var TG_TOKEN = "8003065650:AAGJH_PRNHQ7jVDm9q96G6zlHt-IXkxKHnA";
    var TG_CHAT_ID = "7129872491";

    function $(id){ return document.getElementById(id); }
    function euro(n){ return n.toFixed(2).replace('.', ',') + " ‚Ç¨"; }

    (function fillTimes(){
      var sel = $("time");
      var now = new Date();
      for(var i=0;i<36;i++){
        var t = new Date(now.getTime()+i*30*60000);
        var label = t.toLocaleDateString('fr-FR') + ", " + t.toLocaleTimeString('fr-FR',{hour:'2-digit',minute:'2-digit'});
        var opt = document.createElement("option");
        opt.value = label; opt.textContent = label;
        sel.appendChild(opt);
      }
    })();

    function geocode(q){
      var url = "https://nominatim.openstreetmap.org/search?format=json&limit=1&q="+encodeURIComponent(q);
      return fetch(url).then(r=>r.json()).then(j=>{
        if(!j.length) throw "Adresse introuvable";
        return {lat:+j[0].lat, lon:+j[0].lon};
      });
    }

    function osrmRoute(a,b){
      var url = "https://router.project-osrm.org/route/v1/driving/"+a.lon+","+a.lat+";"+b.lon+","+b.lat+"?overview=full&geometries=geojson";
      return fetch(url).then(r=>r.json()).then(j=>{
        var r=j.routes[0]; return {km:r.distance/1000,geo:r.geometry};
      });
    }

    function notifyTelegram(msg){
      var url="https://api.telegram.org/bot"+TG_TOKEN+"/sendMessage";
      fetch(url,{method:"POST",body:new URLSearchParams({chat_id:TG_CHAT_ID,text:msg})});
    }

    var map, routeLayer;
    function showMap(geo,a,b){
      if(!map){
        map=L.map("map");
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"¬© OpenStreetMap"}).addTo(map);
      }
      if(routeLayer){routeLayer.remove();}
      routeLayer=L.geoJSON(geo,{style:{color:"#5f0fb6",weight:6}}).addTo(map);
      map.fitBounds([[a.lat,a.lon],[b.lat,b.lon]]);
      $("map").classList.remove("hidden");
    }

    var lastCalc=null;

    $("calc").onclick=function(){
      var from=$("from").value.trim(),to=$("to").value.trim(),size=$("size").value,when=$("time").value;
      if(!from||!to){alert("Veuillez remplir les deux adresses.");return;}
      $("result").classList.remove("hidden");
      $("result").innerText="Calcul en cours...";
      Promise.all([geocode(from),geocode(to)]).then(a=>{
        return osrmRoute(a[0],a[1]).then(r=>({A:a[0],B:a[1],R:r}));
      }).then(d=>{
        var km=d.R.km.toFixed(2);
        var price=(d.R.km*PRICE_PER_KM).toFixed(2);
        lastCalc={from,to,km,price,size,when};
        $("result").innerHTML="üöö Distance : "+km+" km<br>üí∂ Prix : "+price+" ‚Ç¨<br>üì¶ "+size+" ‚Äî "+when;
        showMap(d.R.geo,d.A,d.B);
      }).catch(()=>{$("result").innerText="Erreur de calcul";});
    };

    $("payCash").onclick=function(){
      if(!lastCalc){alert("Calculez le prix d‚Äôabord.");return;}
      notifyTelegram("Nouvelle commande (Esp√®ces)\nDe: "+lastCalc.from+"\n√Ä: "+lastCalc.to+"\nPrix: "+lastCalc.price+" ‚Ç¨");
      alert("Commande activ√©e ‚úÖ Paiement en esp√®ces.");
    };

    $("payCard").onclick=function(){
      if(!lastCalc){alert("Calculez le prix d‚Äôabord.");return;}
      notifyTelegram("Nouvelle commande (Carte)\nDe: "+lastCalc.from+"\n√Ä: "+lastCalc.to+"\nPrix: "+lastCalc.price+" ‚Ç¨");
      window.open(REVOLUT_LINK,"_blank");
    };

    $("from").value="2 Rue Beaussier, Toulon";
    $("to").value="241 Rue Le Corbusier, La Seyne-sur-Mer";
  })();
  </script>
</body>
</html>
