<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Alex Livraison 🚗🚴‍♂️</title>
  <style>
    body{margin:0;font-family:sans-serif;background:#5b1dd8;color:#fff;display:flex;flex-direction:column;align-items:center}
    h1{margin:20px;font-weight:800}
    .box{background:#fff;color:#111;border-radius:20px;padding:20px;width:90%;max-width:420px}
    label{display:block;margin:10px 0 5px}
    input,select{width:100%;padding:10px;border-radius:10px;border:1px solid #ccc;font-size:15px}
    button{width:100%;margin-top:10px;padding:14px;border:none;border-radius:12px;font-weight:700;color:#fff;font-size:16px;cursor:pointer}
    #calc{background:#6b00ff}
    #payCard{background:#9d00ff}
    #payCash{background:#007aff}
    #result,#msg{margin-top:10px;text-align:center;font-weight:700}
  </style>
</head>
<body>
  <h1>Alex Livraison 🚗🚴‍♂️</h1>
  <div class="box">
    <label>Adresse de départ</label>
    <input id="start" placeholder="Ex: 241 Rue Le Corbusier, La Seyne-sur-Mer">
    <label>Adresse de destination</label>
    <input id="end" placeholder="Ex: 2 Rue Beaussier, Toulon">
    <label>Taille du colis 📦</label>
    <select id="size">
      <option value="S">Petit (S)</option>
      <option value="M">Moyen (M)</option>
      <option value="L">Grand (L)</option>
      <option value="XL">Très grand (XL)</option>
    </select>
    <label>Heure de livraison</label>
    <input id="time" type="datetime-local">
    <button id="calc">Calculer le prix</button>
    <div id="result"></div>
    <button id="payCard">Paiement par carte (Revolut)</button>
    <button id="payCash">Paiement en espèces à la livraison</button>
    <div id="msg"></div>
  </div>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDaUyjOAjx9TNonfUF5psKSpxunrgr2h6g&libraries=places&language=fr" defer></script>
  <script>
    document.addEventListener("DOMContentLoaded",()=>{
      // init time
      const t=new Date(Date.now()+30*60000);
      document.getElementById("time").value=t.toISOString().slice(0,16);

      // init autocomplete
      const ac1=new google.maps.places.Autocomplete(document.getElementById("start"),{componentRestrictions:{country:"fr"}});
      const ac2=new google.maps.places.Autocomplete(document.getElementById("end"),{componentRestrictions:{country:"fr"}});

      const calcBtn=document.getElementById("calc");
      const payCard=document.getElementById("payCard");
      const payCash=document.getElementById("payCash");
      const res=document.getElementById("result");
      const msg=document.getElementById("msg");

      let prix=0;

      calcBtn.onclick=()=>{
        const start=document.getElementById("start").value;
        const end=document.getElementById("end").value;
        const size=document.getElementById("size").value;
        if(!start||!end){res.textContent="⚠️ Entrez les deux adresses";return;}
        const svc=new google.maps.DistanceMatrixService();
        svc.getDistanceMatrix({origins:[start],destinations:[end],travelMode:"DRIVING",unitSystem:google.maps.UnitSystem.METRIC},
        (r,s)=>{
          if(s!=="OK"){res.textContent="Erreur Google Maps";return;}
          const km=r.rows[0].elements[0].distance.value/1000;
          const mult={S:1,M:1.2,L:1.5,XL:1.8}[size];
          prix=Math.max(3+km*0.8*mult,5).toFixed(2);
          res.innerHTML=🚚 ${km.toFixed(2)} km → 💶 ${prix} €;
        });
      };

      payCard.onclick=()=>{
        if(!prix){msg.textContent="Calculez d’abord le prix";return;}
        window.open("https://checkout.revolut.com/pay/10d5b369-d7f0-43cb-a810-af4c7afe9d27","_blank");
        msg.textContent="✅ Commande activée (paiement par carte)";
        msg.style.color="#16a34a";
      };

      payCash.onclick=()=>{
        msg.textContent="✅ Commande activée (paiement en espèces)";
        msg.style.color="#16a34a";
      };
    });
  </script>
</body>
</html>
