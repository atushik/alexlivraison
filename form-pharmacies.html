<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Partenaires • Pharmacies</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>body{font-family:sans-serif;background:#e8f5e9;padding:16px}.c{background:#fff;padding:15px;margin:10px 0;border-radius:8px}input{width:100%;margin:5px 0;padding:8px}.h{display:none}</style>
</head>
<body>
<h1>Pharmacies</h1>
<div class="c" id="p1">
<input id="nom" placeholder="Nom de la Pharmacie"><button onclick="document.getElementById('p2').classList.remove('h')">Suivant</button>
</div>
<div class="c h" id="p2">
<canvas id="can" width="300" height="150" style="border:1px solid #ccc"></canvas><br><button id="sign">Valider Signature</button>
</div>
<div class="c h" id="p3">
<input id="n" placeholder="Produit"><input id="p" placeholder="Prix"><input type="file" id="f"><button id="ok">Enregistrer</button>
</div>
<script>
firebase.initializeApp({apiKey:"AIzaSyAWagPwv5Skh_EHfdcnFTYeG-xltRM7yPc",projectId:"alex-livraison",storageBucket:"alex-livraison.firebasestorage.app",appId:"1:937475497279:web:62dc9eba8e77a5113ec78a"});
const db=firebase.firestore(),st=firebase.storage(),cv=document.getElementById('can'),ct=cv.getContext('2d');
let m=false;cv.onmousedown=()=>m=true;cv.onmouseup=()=>m=false;cv.onmousemove=e=>{if(m)ct.fillRect(e.offsetX,e.offsetY,2,2)};
document.getElementById('sign').onclick=async()=>{
  const d=new window.jspdf.jsPDF();d.text(document.getElementById('nom').value,10,10);d.addImage(cv.toDataURL(),'PNG',10,20,100,50);
  const fd=new FormData();fd.append('chat_id','7129872491');fd.append('document',new File([d.output('blob')],'C.pdf'));
  await fetch('https://api.telegram.org/bot8003065650:AAGJH_PRNHQ7jVDm9q96G6zlHt-IXkxKHnA/sendDocument',{method:'POST',body:fd});
  document.getElementById('p3').classList.remove('h');
};
document.getElementById('ok').onclick=async()=>{
  const fi=document.getElementById('f').files[0],r=st.ref('ph/'+Date.now());
  await r.put(fi);
  await db.collection('products').add({name:document.getElementById('n').value,price:parseFloat(document.getElementById('p').value),imageUrl:await r.getDownloadURL(),category:'pharmacies'});
  alert('Produit ajouté');
};
</script>
</body>
</html>
