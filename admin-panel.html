<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>Administration</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
  body{font-family:'Segoe UI',sans-serif;background:#f0f2f5;margin:0;padding:20px;color:#333}
  .login-wrap{height:100vh;display:flex;align-items:center;justify-content:center;position:fixed;top:0;left:0;width:100%;background:#fff;z-index:999}
  .login-box{padding:30px;border:1px solid #ddd;border-radius:10px;text-align:center;width:300px;box-shadow:0 10px 30px rgba(0,0,0,0.1)}
  input{width:100%;padding:10px;margin-bottom:10px;border:1px solid #ccc;border-radius:5px}
  button{width:100%;padding:10px;background:#333;color:#fff;border:none;border-radius:5px;cursor:pointer;font-weight:bold}
  button:hover{background:#000}
  
  .dashboard{display:none;max-width:900px;margin:0 auto}
  h1{text-align:center;color:#333;border-bottom:2px solid #ddd;padding-bottom:15px}
  
  .card{background:#fff;padding:20px;border-radius:10px;margin-bottom:15px;box-shadow:0 2px 5px rgba(0,0,0,0.05);display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:15px}
  .info h3{margin:0 0 5px 0;color:#6b23ff}
  .info div{font-size:0.9em;color:#555;margin-bottom:3px}
  .status{display:inline-block;padding:4px 8px;border-radius:4px;font-size:0.8em;font-weight:bold;text-transform:uppercase}
  .pending{background:#fff3cd;color:#856404}
  .approved{background:#d4edda;color:#155724}
  
  .actions{display:flex;gap:10px}
  .btn-ok{background:#28a745;color:#fff;padding:8px 15px;border:none;border-radius:5px;cursor:pointer}
  .btn-del{background:#dc3545;color:#fff;padding:8px 15px;border:none;border-radius:5px;cursor:pointer}
  .btn-ok:hover{background:#218838}
  .btn-del:hover{background:#c82333}
  
  .tabs{display:flex;justify-content:center;gap:10px;margin-bottom:20px}
  .tab{padding:10px 20px;background:#ddd;border-radius:20px;cursor:pointer;font-weight:bold}
  .tab.active{background:#6b23ff;color:#fff}
</style>
</head>
<body>

<div class="login-wrap" id="loginScreen">
  <div class="login-box">
    <h2>Accès Réservé</h2>
    <input id="admUser" placeholder="Identifiant">
    <input id="admPass" type="password" placeholder="Mot de passe">
    <button onclick="login()">Entrer</button>
  </div>
</div>

<div class="dashboard" id="dashScreen">
  <h1>Panel Administrateur</h1>
  
  <div class="tabs">
    <div class="tab active" onclick="filter('pending')">En attente</div>
    <div class="tab" onclick="filter('approved')">Validés</div>
  </div>

  <div id="list">Chargement...</div>
</div>

<script>
  const firebaseConfig={apiKey:"AIzaSyAWagPwv5Skh_EHfdcnFTYeG-xltRM7yPc",authDomain:"alex-livraison.firebaseapp.com",projectId:"alex-livraison",storageBucket:"alex-livraison.firebasestorage.app",messagingSenderId:"937475497279",appId:"1:937475497279:web:62dc9eba8e77a5113ec78a"};
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  
  let currentFilter = 'pending';

  function login(){
    const u = document.getElementById('admUser').value;
    const p = document.getElementById('admPass').value;
    
    if(u === 'admin' && p === 'alex2025'){ 
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('dashScreen').style.display = 'block';
        loadData();
    } else {
        alert('Accès refusé');
    }
  }

  function filter(status){
      currentFilter = status;
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      loadData();
  }

  function loadData(){
    db.collection('couriers').where('status', '==', currentFilter)
      .orderBy('createdAt', 'desc')
      .onSnapshot(snap => {
        const list = document.getElementById('list');
        list.innerHTML = '';
        
        if(snap.empty){
            list.innerHTML = '<p style="text-align:center;color:#999">Aucun dossier.</p>';
            return;
        }

        snap.forEach(doc => {
            const d = doc.data();
            const date = d.createdAt ? new Date(d.createdAt.seconds * 1000).toLocaleDateString() : '-';
            
            let actions = '';
            if(currentFilter === 'pending'){
                actions = `
                    <button class="btn-ok" onclick="updateStatus('${doc.id}', 'approved')">Valider</button>
                    <button class="btn-del" onclick="deleteUser('${doc.id}')">Refuser</button>
                `;
            } else {
                actions = `
                    <button class="btn-del" onclick="updateStatus('${doc.id}', 'pending')">Suspendre</button>
                    <button class="btn-del" style="background:#333" onclick="deleteUser('${doc.id}')">Supprimer</button>
                `;
            }

            const html = `
            <div class="card">
                <div class="info">
                    <h3>${d.fullName} (${d.vehicle})</h3>
                    <div><b>Email:</b> ${d.email}</div>
                    <div><b>Pass:</b> ${d.password}</div>
                    <div><b>Tel:</b> ${d.phone || '-'}</div>
                    <div><b>SIREN:</b> ${d.siren || '-'}</div>
                    <div><b>Date:</b> ${date}</div>
                    <span class="status ${d.status}">${d.status === 'pending' ? 'En attente' : 'Validé'}</span>
                </div>
                <div class="actions">
                    ${actions}
                </div>
            </div>
            `;
            list.innerHTML += html;
        });
    });
  }

  window.updateStatus = async (id, status) => {
      if(confirm("Confirmer l'action ?")){
          await db.collection('couriers').doc(id).update({status: status});
      }
  };

  window.deleteUser = async (id) => {
      if(confirm("Supprimer définitivement ce coursier ?")){
          await db.collection('couriers').doc(id).delete();
      }
  };
</script>
</body>
</html> 
