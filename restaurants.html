<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>Partenaires • Restaurants | AlexLivraison</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin>
<style>
:root{--violet:#6b23ff;--violet-dark:#32006b;--green:#4caf50;--ring:#ffffff35}
body{margin:0;font-family:system-ui,Arial;background:linear-gradient(180deg,#32006b,#7a2cf5);color:#222}
.wrap{max-width:1060px;margin:auto;padding:16px}
.topbar{background:rgba(20,0,45,.8);backdrop-filter:blur(12px);color:#fff;padding:12px;display:flex;justify-content:space-between;align-items:center}
.topbar img{width:120px;height:auto}
.btn{background:#ffffff14;border:1px solid #ffffff33;color:#fff;padding:10px 16px;border-radius:10px;text-decoration:none}
.card{background:#fff;border-radius:14px;padding:18px;box-shadow:0 14px 40px rgba(0,0,0,.22);margin-top:14px}
.h1{color:#fff;font-weight:900;text-align:center;margin-top:20px}
.h2{font-weight:900;margin-bottom:10px}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
label{font-weight:700;margin-top:8px;display:block}
input,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #ccc;margin-top:4px}
textarea{min-height:100px;resize:vertical}
.lock{opacity:.6;pointer-events:none}
.btn-primary{background:#6b23ff;color:#fff;border:none;padding:12px 16px;border-radius:10px;cursor:pointer}
.notice{background:#13002b;color:#fff;border:1px solid #ffffff2e;border-radius:16px;padding:14px;text-align:center;margin-top:12px}
.sig-wrap{border:1px dashed #b6b4d6;border-radius:12px;overflow:hidden;background:#fff}
canvas#signature{width:100%;height:220px;display:block}
.list{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px;margin-top:12px}
.item{background:#fff;border-radius:12px;box-shadow:0 8px 26px rgba(0,0,0,.12);padding:12px}
.item img{width:100%;height:140px;object-fit:cover;border-radius:10px;margin-bottom:8px;background:#f3f3f8}
</style>
</head>
<body>
<div class="topbar">
  <img src="logo.jpg" alt="AlexLivraison">
  <a href="index.html" class="btn">Retour au site</a>
</div>

<main class="wrap">
  <h1 class="h1">Restaurants • Portail Partenaire</h1>

  <section class="card">
    <h2 class="h2">Présentation</h2>
    <div style="color:#000">Livraison rapide de repas pour vos clients avec gestion des commandes, prise en charge directe au restaurant et suivi en temps réel. Service professionnel et ponctuel.</div>
  </section>

  <section id="step1" class="card">
    <h2 class="h2">Formulaire de collaboration</h2>
    <div class="grid2">
      <div><label>Nom de l’enseigne</label><input id="f_enseigne"></div>
      <div><label>Catégorie</label><input id="f_cat" value="Restaurant" readonly></div>
    </div>
    <div class="grid3">
      <div><label>Nom et prénom du responsable</label><input id="f_resp"></div>
      <div><label>SIREN</label><input id="f_siren"></div>
      <div><label>SIRET</label><input id="f_siret"></div>
    </div>
    <div class="grid2">
      <div><label>Adresse complète</label><input id="f_addr"></div>
      <div><label>Téléphone</label><input id="f_tel"></div>
    </div>
    <div class="grid2">
      <div><label>E-mail</label><input id="f_mail"></div>
      <div><label>Message</label><input id="f_msg"></div>
    </div>
    <button id="btn_step1" class="btn-primary">Valider l’étape 1</button>
  </section>

  <section id="step2" class="card lock">
    <h2 class="h2">Convention de Collaboration</h2>
    <div class="grid2">
      <div><label>Nom du signataire</label><input id="sign_name"></div>
      <div><label>Date</label><input id="sign_date" type="date"></div>
    </div>
    <div class="sig-wrap" style="margin-top:10px"><canvas id="signature"></canvas></div>
    <div style="margin-top:10px"><input type="checkbox" id="agree"> J’accepte la convention</div>
    <button id="gen_pdf" class="btn-primary" style="margin-top:10px">Signer et générer la convention</button>
    <a id="dl_partner" class="btn" style="display:none" download="Convention_Restaurant.pdf">Télécharger</a>
    <div class="notice">Après signature, la convention sera envoyée à AlexLivraison.</div>
  </section>

  <section id="step3" class="card lock">
    <h2 class="h2">Ajout de plats</h2>
    <div class="grid3">
      <div><label>Nom du plat</label><input id="p_name"></div>
      <div><label>Prix (€)</label><input id="p_price" type="number" step="0.01"></div>
      <div><label>Photo</label><input id="p_photo" type="file" accept="image/*"></div>
    </div>
    <label>Description</label><textarea id="p_desc"></textarea>
    <button id="add_product" class="btn-primary">Ajouter</button>
    <div id="list" class="list"></div>
  </section>
</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const TELEGRAM_TOKEN="8003065650:AAGJH_PRNHQ7jVDm9q96G6zlHt-IXkxKHnA";
const TELEGRAM_CHAT="7129872491";
const alexName="ATABEK ZAKIROV";
const alexLogo="logo.jpg";
const alexStamp="stamp-alex.jpg";
const alexSign="sinature-alex.jpg";

const step1=document.getElementById('step1');
const step2=document.getElementById('step2');
const step3=document.getElementById('step3');
const btn1=document.getElementById('btn_step1');

btn1.onclick=()=>{
  const fields=['f_enseigne','f_resp','f_siren','f_siret','f_addr','f_tel','f_mail'];
  for(const id of fields){if(!document.getElementById(id).value.trim())return alert('Veuillez remplir tous les champs.');}
  step2.classList.remove('lock');
};

const canvas=document.getElementById('signature');
const ctx=canvas.getContext('2d');
let drawing=false;
canvas.addEventListener('mousedown',e=>{drawing=true;ctx.beginPath();ctx.moveTo(e.offsetX,e.offsetY);});
canvas.addEventListener('mousemove',e=>{if(!drawing)return;ctx.lineTo(e.offsetX,e.offsetY);ctx.stroke();});
canvas.addEventListener('mouseup',()=>drawing=false);

document.getElementById('gen_pdf').onclick=async()=>{
  const {jsPDF}=window.jspdf;
  const doc=new jsPDF({unit:'pt',format:'a4'});
  const margin=48;let y=margin;
  doc.setFontSize(18).setFont('helvetica','bold');
  doc.text('Convention de Collaboration',margin,y);y+=26;
  doc.addImage(alexLogo,'JPEG',450,20,100,100);
  doc.setFontSize(12).setFont('helvetica','');
  const en=document.getElementById('f_enseigne').value;
  const cat=document.getElementById('f_cat').value;
  const resp=document.getElementById('f_resp').value;
  const siret=document.getElementById('f_siret').value;
  const addr=document.getElementById('f_addr').value;
  const tel=document.getElementById('f_tel').value;
  const mail=document.getElementById('f_mail').value;
  const lines=[
    `Entre AlexLivraison (représenté par ${alexName}) et ${en} (${cat}).`,
    `Responsable : ${resp}`,
    `SIRET : ${siret}`,
    `Adresse : ${addr}`,
    `Téléphone : ${tel} – Email : ${mail}`,
    'Objet : Livraison de repas pour les clients du restaurant.',
    'Conditions : 5 premières livraisons gratuites et engagement de collaboration sur 1 an.',
    'Période d’essai : 2 semaines.',
    'Engagements : qualité, ponctualité, respect des clients et des délais.',
    'Durée : à compter de la signature, préavis de 15 jours.'
  ];
  for(const t of lines){doc.text(doc.splitTextToSize(t,520),margin,y);y+=16;}
  y+=10;const d=document.getElementById('sign_date').value;const n=document.getElementById('sign_name').value;
  doc.text(`Date: ${d}`,margin,y);y+=16;
  doc.text(`Signataire: ${n}`,margin,y);y+=12;
  const sig=canvas.toDataURL('image/png');doc.addImage(sig,'PNG',margin,y,220,110);
  doc.addImage(alexSign,'JPEG',margin+240,y,220,110);
  y+=120;doc.addImage(alexStamp,'JPEG',margin+160,y,120,120);
  const blob=doc.output('blob');const url=URL.createObjectURL(blob);
  document.getElementById('dl_partner').href=url;
  document.getElementById('dl_partner').style.display='inline-block';
  step3.classList.remove('lock');
  const formData=new FormData();formData.append('document',blob,'Convention_Restaurant.pdf');
  await fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendDocument?chat_id=${TELEGRAM_CHAT}`,{method:'POST',body:formData});
};

document.getElementById('add_product').onclick=()=>{
  if(step3.classList.contains('lock'))return alert('Veuillez d’abord signer la convention.');
  const name=document.getElementById('p_name').value.trim();
  const price=document.getElementById('p_price').value.trim();
  if(!name||!price)return alert('Nom et prix requis.');
  const list=document.getElementById('list');
  const card=document.createElement('div');card.className='item';
  card.innerHTML=`<div style="font-weight:800">${name}</div><div>${Number(price).toFixed(2)} €</div>`;
  list.appendChild(card);
};
</script>
</body>
</html>
