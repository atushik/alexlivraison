<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>Admin Panel - AlexLivraison</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
  body{font-family:'Segoe UI',sans-serif;background:#f4f6f8;margin:0;padding:20px;color:#333}
  
  .login-wrap{height:100vh;display:flex;align-items:center;justify-content:center;position:fixed;top:0;left:0;width:100%;background:#fff;z-index:999}
  .login-box{padding:30px;border:1px solid #ddd;border-radius:12px;text-align:center;width:300px;box-shadow:0 10px 30px rgba(0,0,0,0.1)}
  input{width:100%;padding:12px;margin-bottom:10px;border:1px solid #ccc;border-radius:8px;box-sizing:border-box}
  button{width:100%;padding:12px;background:#333;color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:bold;transition:0.3s}
  button:hover{background:#000}

  .dashboard{display:none;max-width:900px;margin:0 auto}
  h1{text-align:center;color:#333;margin-bottom:30px}

  .tabs{display:flex;justify-content:center;gap:10px;margin-bottom:25px}
  .tab{padding:10px 25px;background:#e0e0e0;border-radius:25px;cursor:pointer;font-weight:bold;transition:0.3s;border:none}
  .tab.active{background:#6b23ff;color:#fff;box-shadow:0 4px 10px rgba(107,35,255,0.3)}

  .courier-card{background:#fff;padding:20px;border-radius:16px;margin-bottom:15px;box-shadow:0 4px 10px rgba(0,0,0,0.05);display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:15px;border-left:5px solid #ddd}
  .courier-card.pending{border-left-color:#f39c12}
  .courier-card.approved{border-left-color:#2ecc71}

  .info h3{margin:0 0 5px 0;color:#6b23ff}
  .info p{margin:2px 0;color:#555;font-size:0.95em}
  .badge{display:inline-block;padding:4px 10px;border-radius:6px;font-size:0.8em;font-weight:bold;margin-top:5px}
  .bg-pending{background:#fff3cd;color:#856404}
  .bg-approved{background:#d4edda;color:#155724}

  .actions{display:flex;gap:10px}
  .btn-approve{background:#2ecc71;color:#fff;padding:10px 20px;border:none;border-radius:8px;cursor:pointer;font-weight:bold}
  .btn-reject{background:#e74c3c;color:#fff;padding:10px 20px;border:none;border-radius:8px;cursor:pointer;font-weight:bold}
  .btn-suspend{background:#f39c12;color:#fff;padding:10px 20px;border:none;border-radius:8px;cursor:pointer;font-weight:bold}
  
  .error-alert{background:#fee2e2;color:#991b1b;padding:15px;border-radius:8px;margin-bottom:20px;border:1px solid #fca5a5;display:none}
  .empty-state{text-align:center;color:#888;margin-top:50px;font-size:1.2em}
</style>
</head>
<body>

<div class="login-wrap" id="loginScreen">
  <div class="login-box">
    <h2>Acc√®s Admin</h2>
    <input id="admUser" placeholder="Identifiant">
    <input id="admPass" type="password" placeholder="Mot de passe">
    <button onclick="login()">Connexion</button>
  </div>
</div>

<div class="dashboard" id="dashScreen">
  <h1>Panel Administrateur</h1>
  
  <div class="tabs">
    <button class="tab active" onclick="filter('pending')">En attente</button>
    <button class="tab" onclick="filter('approved')">Valid√©s</button>
  </div>

  <div id="errorBox" class="error-alert"></div>
  <div id="list">Chargement des donn√©es...</div>
</div>

<script>
  const firebaseConfig={apiKey:"AIzaSyAWagPwv5Skh_EHfdcnFTYeG-xltRM7yPc",authDomain:"alex-livraison.firebaseapp.com",projectId:"alex-livraison",storageBucket:"alex-livraison.firebasestorage.app",messagingSenderId:"937475497279",appId:"1:937475497279:web:62dc9eba8e77a5113ec78a"};
  
  try {
    firebase.initializeApp(firebaseConfig);
  } catch(e) {
    console.error(e);
  }
  
  const db = firebase.firestore();
  let currentFilter = 'pending';

  function login(){
    const u = document.getElementById('admUser').value;
    const p = document.getElementById('admPass').value;
    
    if(u === 'admin' && p === 'alex2025'){ 
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('dashScreen').style.display = 'block';
        loadData();
    } else {
        alert('Identifiant ou mot de passe incorrect.');
    }
  }

  function filter(status){
      currentFilter = status;
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      loadData();
  }

  function loadData(){
    const list = document.getElementById('list');
    list.innerHTML = '<p style="text-align:center">Chargement...</p>';
    
    db.collection('couriers')
      .where('status', '==', currentFilter)
      .orderBy('createdAt', 'desc')
      .onSnapshot((snap) => {
        list.innerHTML = '';
        
        if (snap.empty) {
            list.innerHTML = '<div class="empty-state">Aucun coursier dans cette liste.</div>';
            return;
        }

        snap.forEach(doc => {
            const d = doc.data();
            const date = d.createdAt ? new Date(d.createdAt.seconds * 1000).toLocaleDateString() : 'N/A';
            
            let actionsButtons = '';
            
            if(currentFilter === 'pending'){
                actionsButtons = `
                    <button class="btn-approve" onclick="changeStatus('${doc.id}', 'approved')">Valider ‚úÖ</button>
                    <button class="btn-reject" onclick="deleteUser('${doc.id}')">Supprimer üóëÔ∏è</button>
                `;
            } else {
                actionsButtons = `
                    <button class="btn-suspend" onclick="changeStatus('${doc.id}', 'pending')">Suspendre ‚è∏Ô∏è</button>
                    <button class="btn-reject" onclick="deleteUser('${doc.id}')">Bannir üö´</button>
                `;
            }

            const cardHTML = `
            <div class="courier-card ${d.status}">
                <div class="info">
                    <h3>${d.fullName}</h3>
                    <p><b>üìß Email:</b> ${d.email}</p>
                    <p><b>üîë Pass:</b> ${d.password}</p>
                    <p><b>üì± Tel:</b> ${d.phone || 'N/A'}</p>
                    <p><b>üè¢ SIREN:</b> ${d.siren || 'N/A'}</p>
                    <p><b>üõµ V√©hicule:</b> ${d.vehicle || 'N/A'}</p>
                    <p style="font-size:0.8em;color:#999">Inscrit le: ${date}</p>
                    <span class="badge ${d.status === 'pending' ? 'bg-pending' : 'bg-approved'}">
                        ${d.status.toUpperCase()}
                    </span>
                </div>
                <div class="actions">
                    ${actionsButtons}
                </div>
            </div>
            `;
            list.innerHTML += cardHTML;
        });

    }, (error) => {
        console.error("Error fetching data: ", error);
        const errBox = document.getElementById('errorBox');
        errBox.style.display = 'block';
        errBox.innerHTML = `<b>Erreur syst√®me :</b> ${error.message}<br><br>Si l'erreur mentionne "permissions", allez dans la console Firebase -> Firestore -> R√®gles et mettez:<br><code>allow read, write: if true;</code>`;
        list.innerHTML = '';
    });
  }

  window.changeStatus = async (id, newStatus) => {
      if(confirm(`Changer le statut en "${newStatus}" ?`)){
          try {
            await db.collection('couriers').doc(id).update({status: newStatus});
          } catch(e) {
            alert("Erreur de mise √† jour: " + e.message);
          }
      }
  };

  window.deleteUser = async (id) => {
      if(confirm("Voulez-vous vraiment supprimer ce dossier ?")){
          try {
            await db.collection('couriers').doc(id).delete();
          } catch(e) {
            alert("Erreur de suppression: " + e.message);
          }
      }
  };
</script>
</body>
</html> 
